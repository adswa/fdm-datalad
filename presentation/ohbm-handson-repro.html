<!doctype html>
<html lang="en">
<head>
  <title> Reproducible Workflows </title>
  <meta name="description" content=" ohbm-hackathon-2021-hands-on ">
  <meta name="author" content=" Stephan Heunis & Şeyma Bayrak ">

  <meta charset="utf-8">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="css/main.css" id="theme">
  <script src="js/printpdf.js"></script>
</head>
<body>

<div class="reveal">
<div class="slides">

<!-- FRONT PAGE -->

<section>
    <br>
    <h2><small>OHBM Hackathon 2021 - TrainTrack<br>🧠💻</small><br>Reproducible Workflows<br  /><br  /></h2>

  <div style="margin-top:1em;text-align:center">
  <table style="border: none;">
  <tr>
	<td>Stephan Heunis
	  <br><small>
		<a href="https://twitter.com/fMRwhy" target="_blank">
		  <img data-src="pics/twitter.png" style="height:30px;margin:0px" />
		  @fMRwhy</a></small> <small>
            <a href="https://github.com/jsheunis" target="_blank">
              <img data-src="pics/GitHub.png" style="height:30px;margin:0px" />
              jsheunis</a></small>
          
          <small><a href="http://psychoinformatics.de" target="_blank">Psychoinformatics lab</a><br>
            Institute of Neuroscience and Medicine, Brain &amp; Behavior (INM-7)<br>
          </small><br>
        </td>
    <td><img style="height:100px;margin-right:1px" data-src="pics/fzj_logo.svg" />
	  <br></td>
  </tr>
  <tr>
	<td>Şeyma Bayrak
	  <br><small>
		<a href="https://github.com/sheyma" target="_blank">
		  <img data-src="pics/GitHub.png" style="height:30px;margin:0px" />
		  sheyma</a></small>
          <br>
          <small><a href="https://www.cbs.mpg.de/independent-research-groups/cognitive-neurogenetics" target="_blank">Otto Hahn Group Cognitive Neurogenetics</a>
          </small><br>
        </td>
    <td><img style="height:100px;" data-src="pics/MPICBS.png" />
	  <br></td>
  </tr>
  </table>
  </div>
  <br>
  <br>
  <br>
  <div>
      <a href=""><small>Slides</small></a>
  </div>
</section>

<!-- AGENDA -->
<section>
    <h2>Agenda</h2>
    <ul>
        <li>Overview <em>(15 min)</em></li>
        <li>Practical aspects <em>(7 min)</em></li>
        <li>Step 1: share data and code <em>(30 min)</em></li>
        <li>Step 2:  <em>(-- min)</em></li>
        <li>Step 3 <em>(-- min)</em></li>
        <li>Step 4 <em>(-- min)</em></li>

    </ul>

</section>

<!-- OVERVIEW -->
<section>
    <section>
        <h2>Overview</h2>

        <p>You've just published a paper that calculated the cortical thickness 
            for a group of research participants. You've run some statistical tests
            and visualized the results.
        </p>

        <table>
            <tr>
                <td><img src="pics/handson_fig1.png" height="500"></td>
                <td><img src="pics/handson_figs234.png" height="500"></td>
            </tr>
        </table>

    </section>

    <section>
        <h2>Overview</h2>

        <p>Soon after, a researcher in your field sends you an email:
        </p>
        <img src="pics/handson_email1.png">

    </section>

    <section>
        <h2>Overview</h2>
        <p>Our goal for this hands-on session is to guide you through the use of
            several tools for creating a reproducible workflow so that you can go...
        </p>

        <table>
            <tr>
                <td>
                    <div class="fragment fade-in">
                        <p >from reacting like this:</p>
                        <iframe src="https://gifer.com/embed/CfNy" width=480 height=392.170 frameBorder="0" allowFullScreen></iframe>
                    </div>
                </td>
                <td>
                    <div class="fragment fade-in">
                        <p >to reacting like this:</p>
                        <iframe src="https://gifer.com/embed/2I0" width=480 height=390 frameBorder="0" allowFullScreen></iframe>
                    </div>
                </td>
            </tr>
        </table>
        
        
    </section>

    <section>
        <h2>Overview</h2>
        <p>There are many routes to follow, and many tools to help you on your way.
            We are going to take a step-wise, "Galaxy brain" approach:
        </p>
        <img src="pics/handson_galaxy_brain.jpeg">
    </section>

    <section>
        <h2>Overview</h2>
        <p>By the end of this session, you should be able to do the following STEPS:
        </p>
        <ol>
            <li class="fragment fade-in">
                Set up a `requirements.txt` file that specifies package requirements
            </li>
            <li class="fragment fade-in">
                Specify and set up a virtual environment to install requirements
            </li>
            <li class="fragment fade-in">
                Share code, installation, and running instructions via GitHub
            </li>
            <li class="fragment fade-in">
                Transform your code into a Jupyter notebook
            </li>
            <li class="fragment fade-in">
                Set up your code repository to run in the cloud with Binder
            </li>
            <li class="fragment fade-in">
                Understand how containers can play a role in this context
            </li>
            <li class="fragment fade-in">
                Understand the benefits of data management with DataLad
            </li>
        </ol>
    </section>
</section>


<!-- HOUSE RULES -->
<section>
    <section>
        <h2>Practical aspects</h2>
        <ul>
            <li class="fragment fade-in">
                You can follow along without having any specific software or tools installed on your machine.
            </li>
            <li class="fragment fade-in">
                You just need a good internet connection and your browser.
            </li>
            <li class="fragment fade-in">
                We use
                        <a href="https://research.google.com/colaboratory/" target="_blank">
                        <img data-src="pics/handson_colablogo.png" style="height:30px;margin:0px" />
                        Google Colab</a> and
                        <a href="https://mybinder.org/" target="_blank">
                            <img data-src="pics/handson_binderlogo.png" style="height:30px;margin:0px" />
                            myBinder</a>
                as cloud-based tools to demonstrate and run the tasks in the workshop.
            </li>
            <li class="fragment fade-in">
                However, if you have the required software/packages installed locally, feel free to run the tasks on your system (we'll provide instructions).
            </li>
        </ul>
    </section>
    
    <section>
        <h2>Practical aspects</h2>
        <ul>
            <li class="fragment fade-in">
                Hands-on!
                <ul>
                    <li>You will be doing a lot of tasks yourself (together with all of us)</li>
                    <li>The laptop icon (💻) indicates a task for you</li>
                    <li>The eyes icon (👀) means we'll demonstrate something</li>
                    <li>The speech bubble icon (💬 ) indicates time for discussion/opinions</li>
                    <li>Feel free to ask questions at any time (via chat, voice, or video)</li>
        bbl            <li>Live polls, please participate!</li>
                </ul>
            </li>
            <li class="fragment fade-in">
                Useful links:
                <ul>
                    <li>🔗 <a href="">GitHub repository, with data and code for analysis</a></li>
                    <li>🔗 <a href="">Google Colab notebook</a></li>
                    <li>🔗 <a href="">Data source</a></li>
                    <li>🔗 <a href="">These slides</a></li>
                </ul>
            </li>
            <li class="fragment fade-in">
                
            </li>
        </ul>
    </section>

    <section>
        <h2>Practical aspects</h2>
        <h3>Who are you?</h3>
        <a href="http://etc.ch/j6my" target="_blank">http://etc.ch/j6my</a>
        <br><br>
        <a href="http://etc.ch/j6my" target="_blank"><img data-src="pics/handson_pollqr.png" /></a>
    </section>    

    <section>
        <h2>Practical aspects</h2>
        <img src="pics/handson_allofthethings.jpeg">
    </section>
</section>



<!-- Step 1: share data and code -->
<section>
    <section>
        <h2>Step 1: share data and code</h2>

        Why don't we just send them the data and code "via" a download link?
        <br><br>
        <img src="pics/handson_email2.png">

    </section>

    <section>
        <h2>Step 1: share data and code</h2>

        Why don't we just send them the data and code "via" a download link?
        <br><br>
        
        💻 Try it yourself:<br>
        <ul>
            <li><a href="https://filesender.surf.nl/?s=download&token=6ca14fed-12ee-44ce-acfb-7750b689d7f4">paper_data_and_code.zip</a></li>
            <li>💬 What can go wrong?</li>
        </ul>

    </section>

    <section>
        <h2>Step 1: share data and code</h2>

        💬 Why don't we just send them the data and code "via" a download link? 
        <br><br>
        <ul>
            <li class="fragment fade-in">
                You have to create a link and send an email every time someone requests it
            </li>
            <li class="fragment fade-in">
                There are no instructions included for running the analysis
            </li>
            <li class="fragment fade-in">
                The person might not have the correct software or package versions installed
            </li>
            <li class="fragment fade-in">
                They could perhaps figure out from the code which packages are required,
                but installing them might interfere with their existing environment, which
                might break things down the line.
            </li>
        </ul>
  
    </section>

    <section>
        <h2>Step 1: share data and code</h2>

        So they tried running the script on their machine, and then...
        <br><br>
        <img src="pics/handson_email3.png">
        <br>
        💬 What went wrong? What should we have done?
  
    </section>

    <section>
        <h2>Step 1: share data and code</h2>

        To prevent this issue (or similar issues), while still allowing others to run
        the code on their machines, we need to share:
        <br><br>

        <table>
            <tr>
                <td>1.</td>
                <td>The required packages</td>
                <td><strong>requirements.txt</strong></td>
            </tr>
            <tr>
                <td>2.</td>
                <td>The Python version</td>
                <td><strong>virtual environment</strong></td>
            </tr>
            <tr>
                <td>3.</td>
                <td>Instructions for how to use these to successfully run the script</td>
                <td><strong>README</strong></td>
            </tr>
            <tr>
                <td>4.</td>
                <td>Data and code and all of the above in an accessible location</td>
                <td><strong>GitHub</strong></td>
            </tr>
        </table>
  
    </section>

    <section>
        <h2>Step 1: share data and code</h2>

        We'll start with adding our data and code to Github:
        <br><br>
        <h3>In your browser (👀 💻)</h3>

        <ol>
            <li><a href="https://github.com/join" target="_blank">Create a GitHub account</a> if you don't already have one</li>
            <li>Create a new repository ("ohbm-handson-test") with a README and MIT License</li>
            <li>Upload the <code>code</code> and <code>data</code> directories to your repository</li>
            <ul>
                <li>You can only upload max 100 files at once, so you will have to upload the data files in steps</li>
                <li>Take care to keep the correct directory structure</li>
            </ul>
            <li>Commit (i.e. save) these uploads</li>
        </ol>
  
    </section>

    <section>
        <h2>Step 1: share data and code</h2>

        We'll start with adding our data and code to Github:
        <br><br>
        <h3>From the command line (💻)</h3>

        <ol>
            <li><a href="https://github.com/join" target="_blank">Create a GitHub account</a> if you don't already have one</li>
            <li>Create a new repository ("ohbm-handson-test") with a README and MIT License</li>
            <li>Copy the repository URL</li>
            <li>Clone the repository to your machine, and navigate to it</li>
            <li>Copy the <code>code</code> and <code>data</code> directories to your repository</li>
            <li>Commit the changes to git</li>
            <li>Push the changes to GitHub</li>
        </ol>
  
    </section>

    <section>
        <h2>Step 1: share data and code</h2>

        We'll start with adding our data and code to Github:
        <br><br>
        <h3>From the command line (💻)</h3>

        <pre>
            <code data-trim data-line-numbers>
                #!/bin/bash

                ROOTDIR=[where-you-want-to-save-the-repo]
                REPOURL=[insert-your-repo-URL]
                REPONAME=[insert-your-repo-name]
                CONTENTDIR=[insert-path-to-paper_data_and_code-directory]

                cd $ROOTDIR
                git clone $REPOURL
                cd $REPONAME
                
                cp -R $CONTENTDIR/* .
                git add --all
                git commit -m "add data and code to repo"
                git push origin main
            </code>
        </pre>
  
    </section>


    <section>
        <h2>Step 1: share data and code</h2>

        Next, we'll add instructions to the README:
        <br><br>
        <h3>In your browser (👀 💻)</h3>

        <ol>
            <li>Click on the edit button (🖊️) next to "README" on the repo's main page</li>
            <li>Write in your own words: the content of the repo and how to run the analysis</li>
            <ul>
                <li>Editing is done in Markdown format (<a href="https://www.markdownguide.org/cheat-sheet/" target="_blank">cheat sheet</a>)</li>
                <li>You can "Preview" your changes while editing</li>
                <li>If you don't want to use your own words, use the content from <a href="" target="_blank">our example</a></li>
            </ul>
            <li>Commit (i.e. save) these changes</li>
        </ol>
  
    </section>


    <section>
        <h2>Step 1: share data and code</h2>
        
        Next, we'll add instructions to the README:
        <br><br>

        <h3>From the command line (💻)</h3>

        <ol>
            <li>Open the "README.md" file in your favourite text editor</li>
            <li>Write in your own words: the content of the repo and how to run the analysis</li>
            <ul>
                <li>Editing is done in Markdown format (<a href="https://www.markdownguide.org/cheat-sheet/" target="_blank">cheat sheet</a>)</li>
                <li>If you don't want to use your own words, use the content from <a href="" target="_blank">our example</a></li>
            </ul>
            <li>Commit the changes to <code>git</code></li>
            <li>Push the changes to GitHub</li>
        </ol>
  
    </section>

    <section>
        <h2>Step 1: share data and code</h2>
        
        Next, we'll add instructions to the README:
        <br><br>

        <h3>From the command line (💻)</h3>

        <pre>
            <code data-trim data-line-numbers>
                #!/bin/bash
                # After editing and saving the README file
                # Make sure you are located in the repo's root directory

                git add README.md
                git commit -m "add description to readme"
                git push origin main
            </code>
        </pre>
  
    </section>

    <section>
        <h2>Step 1: share data and code</h2>
        <p>
        We have not yet specified the software or package requirements and we have not explained how to set
        up a virtual environment. We'll address these as our next main step in the hands-on session.
        </p>
        <br>
        <table>
            <tr>
                <td>1.</td>
                <td>The required packages</td>
                <td><strong>requirements.txt</strong></td>
                <td> ?</td>
            </tr>
            <tr>
                <td>2.</td>
                <td>The Python version</td>
                <td><strong>virtual environment</strong></td>
                <td> ?</td>
            </tr>
            <tr>
                <td>3.</td>
                <td>Instructions for how to use these to successfully run the script</td>
                <td><strong>README</strong></td>
                <td>✅</td>
            </tr>
            <tr>
                <td>4.</td>
                <td>Data and code and all of the above in an accessible location</td>
                <td><strong>GitHub</strong></td>
                <td>✅</td>
            </tr>
        </table>
        
        <br>


        Well done on achieving your first milestone towards creating a reproducible workflow! 🥳🥳🥳
  
    </section>

</section>


<!-- Step 2: software environment and package requirements -->
<section>
    <section>
        <h2>Step 2: software environment and requirements</h2>

        After sharing the news about the public GitHub repo with our colleague, we get the following reply:
        <br><br>

        <img src="pics/handson_email4.png" height="650">

        <br><br>
        
        Now we'll focus on requirements and virtual environments
        

    </section>

    <section>
        <h2>Step 2: software environment and requirements</h2>

        <h3>Introducing requirements.txt</h3>

        <ul>
            <li>Single file to capture required Python packages</li>
            <li>Makes installation straight-forward with <code>pip</code>:</li>
            <pre>
                <code data-trim data-line-numbers>
                    pip install -r requirements.txt
                </code>
            </pre>
            <li>In the file, you can specify the required packages (check script) and versions:</li>
            <pre>
                <code data-trim data-line-numbers>
                    matplotlib==3.2.2
                    numpy>=1.16.5
                    pandas
                    nibabel
                    nilearn>=0.7.1
                    sklearn
                    brainspace
                </code>
            </pre>
        </ul>

        <br>

        💻 Now, create your own <code>requirements.txt</code> file and add it to your GitHub repo 
        (either in your browser or via <code>git</code>).

    </section>

    <section>
        <h2>Step 2: software environment and requirements</h2>

        <h3>Introducing requirements.txt</h3>

        <div style="text-align:justify">
            NOTE: not all packages/tools required for an analysis are necessarily
            Python packages, or if they are they might not be available on the
            <a href="https://pypi.org/">Python Package Index (PyPI)</a>. This means
            that installing everything with <code>pip</code> and a <code>requirements.txt</code>
            file might not be sufficient:
        </div>
        <br>
        <ul>
            <li>Check whether some packages/tools might have to be installed differently:</li>
            <ul>
                <li><a href="https://wiki.debian.org/Apt">APT</a>: for managing packages (retrieval, configuration and installation) on Unix-like computer systems</li>
                <li><a href="https://docs.conda.io/en/latest/">conda</a>: Package, dependency and environment management for any language running on Windows, macOS and Linux</li>
            </ul>
            <li>Add extra installation instructions to README</li>
        </ul>

        <br>

    </section>

    <section>
        <h2>Step 2: software environment and requirements</h2>

        <h3>Introducing Virtual Enviroments</h3>

        <table>
            <tr>
                <td style="width: 40%;">
                    <ul>
                        <li><code>requirements.txt</code> helps a lot, but what if the colleague already has some of these packages installed? 💬</li>
                        <li>Installing new packages or existing packages with different versions can interfere with their local Python setup, and cause errors.</li>
                    </ul>
                </td>
                <td>
                    <img src="pics/handson_python_environment.png" width="600">
                </td>
            </tr>
        </table>

        

        
        
    </section>

    <section>
        <h2>Step 2: software environment and requirements</h2>

        <h3>Introducing Virtual Enviroments</h3>

        <div style="text-align:justify">
            It would be great if colleagues could install our package requirements in a <strong>clean and isolated</strong> environment ==> virtual environments!
        </div>
        
        <ul>
            <li><a href="https://virtualenv.pypa.io/en/latest/">virtualenv</a></li>
            <pre>
                <code data-trim data-line-numbers>
                    #!/bin/bash
                    pip install virtualenv #install the package
                    virtualenv --python=python3 mypythonenv #create a new virtual environment
                    source mypythonenv/bin/activate #activate the virtual environment
                    # now do install your packages with pip and do the analysis
                    deactivate #deactivate the virtual environment
                </code>
            </pre>
            <li><a href="https://docs.conda.io/en/latest/miniconda.html">miniconda</a></li>
            <pre>
                <code data-trim data-line-numbers>
                    #!/bin/bash
                    # install miniconda using install files via link
                    conda create -n mypythonenv python=3.6
                    conda activate mypythonenv
                    # now do install your packages with conda and/or pip and do the analysis
                    conda deactivate #deactivate the virtual environment
                </code>
            </pre>
        </ul>
        
    </section>


    <section>
        <h2>Step 2: software environment and requirements</h2>

        <h3>Introducing Virtual enviroments</h3>

        <ul>
            <li><code>requirements.txt</code> helps a lot, but what if the colleague already has some of these packages installed? 💬</li>
            <li>Installing new packages or existing packages with different versions can interfere with their local Python setup, and cause errors.</li>
            <li>It would be great if they could install our package requirements in a <strong>clean</strong> environment ==> virtual environments!</li>
            <ul>
                <li>Miniconda</li>
                <li>virtualenv</li>
            </ul>
        </ul>
        <br><br>
        lorum ipsum
        <br><br>
        <pre>
            <code>
                #!/bin/bash

                conda create -n testenv python=3.6
                conda activate testenv
                
                git clone https://github.com/ohbm/handson-2021-reproducible-workflows.git
                cd handson-2021-reproducible-workflows
                
                pip install requirements.txt
            </code>
        </pre>
        
    </section>
</section>


</div> <!-- /.slides -->
</div> <!-- /.reveal -->

<script src="js/reveal.js"></script>


<script>
  // Full list of configuration options available at:
  // https://github.com/hakimel/reveal.js#configuration
  Reveal.initialize({
    // The "normal" size of the presentation, aspect ratio will be preserved
    // when the presentation is scaled to fit different resolutions. Can be
    // specified using percentage units.
    width: 1280,
    height: 960,

    // Factor of the display size that should remain empty around the content
    margin: 0.1,

    // Bounds for smallest/largest possible scale to apply to content
    minScale: 0.2,
    maxScale: 1.0,

    controls: true,
    progress: true,
    history: true,
    center: true,

    transition: 'slide', // none/fade/slide/convex/concave/zoom

    // Optional reveal.js plugins
    dependencies: [
      { src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
      { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'plugin/zoom-js/zoom.js', async: true },
      { src: 'plugin/notes/notes.js', async: true }
    ]
  });
</script>
</body>
</html>
